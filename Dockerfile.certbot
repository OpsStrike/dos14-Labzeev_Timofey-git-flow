FROM ubuntu:18.04

RUN apt-get update && apt-get install -y git

RUN useradd -d /home/bank -U -m -u 3333 bank && mkdir /home/bank/git

WORKDIR /home/bank/git
                    
COPY --chown=bank:bank . .

RUN git clone -b 1.9.x --single-branch https://github.com/certbot/certbot.git && \
    chmod a+x ./certbot/certbot-auto
    
USER bank

RUN chmod +x /home/bank/git/setup_certificates.sh

EXPOSE 80 443

ENTRYPOINT ["/home/bank/git/setup_certificates.sh"]
